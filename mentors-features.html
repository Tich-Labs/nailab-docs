<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nailab - Mentors Features</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50" data-page-title="Mentors Features">
    <div class="min-h-screen">
        <div id="nailabHeader"></div>
        <script src="shared.js"></script>
        <script>window.NailabShared.renderHeader();</script>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Overview Stats -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-8 animate-slide-in">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="text-center">
                            <div class="flex justify-center mb-2">
                                <svg class="w-12 h-12 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        <h3 id="statCompletePercent" class="text-2xl font-bold text-green-600">0%</h3>
                        <p class="text-sm text-gray-600">Complete</p>
                    </div>
                        <div class="text-center">
                            <div class="flex justify-center mb-2">
                                <svg class="w-12 h-12 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        <h3 id="statInProgress" class="text-2xl font-bold text-yellow-600">0</h3>
                        <p class="text-sm text-gray-600">In Progress</p>
                    </div>
                        <div class="text-center">
                            <div class="flex justify-center mb-2">
                                <svg class="w-12 h-12 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                </svg>
                            </div>
                        <h3 id="statMissing" class="text-2xl font-bold text-red-600">18</h3>
                        <p class="text-sm text-gray-600">Missing</p>
                    </div>
                        <div class="text-center">
                            <div class="flex justify-center mb-2">
                                <svg class="w-12 h-12 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                                </svg>
                            </div>
                        <h3 id="statTotal" class="text-2xl font-bold text-blue-600">18</h3>
                        <p class="text-sm text-gray-600">Total Features</p>
                    </div>
                </div>
            </div>

            <!-- Legend -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
                <h3 class="text-lg font-semibold mb-4">Status Legend</h3>
                <p class="text-sm text-gray-600 mb-4">Tip: drag cards between columns (including back). Double-click a card to edit its title/description.</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-4 h-4 bg-green-500 rounded-full"></div>
                        <div>
                            <p class="font-medium">Complete ‚úÖ</p>
                            <p class="text-sm text-gray-600">Feature is fully implemented and functional</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="w-4 h-4 bg-yellow-500 rounded-full"></div>
                        <div>
                            <p class="font-medium">Partial üü°</p>
                            <p class="text-sm text-gray-600">Feature exists but needs enhancements</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="w-4 h-4 bg-red-500 rounded-full"></div>
                        <div>
                            <p class="font-medium">Missing ‚ùå</p>
                            <p class="text-sm text-gray-600">Feature is not implemented</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Kanban Board -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Completed Column -->
                <div class="bg-green-50 rounded-lg border border-green-200">
                    <div class="p-4 border-b border-green-200">
                        <h3 class="font-semibold text-green-800 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Completed (<span id="countComplete">0</span>)
                        </h3>
                    </div>
                    <div class="p-4 space-y-3 kanban-column" data-column="complete">
                        <!-- Completed column intentionally left empty -->
                    </div>
                </div>

                <!-- In Progress Column -->
                <div class="bg-yellow-50 rounded-lg border border-yellow-200">
                    <div class="p-4 border-b border-yellow-200">
                        <h3 class="font-semibold text-yellow-800 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            In Progress (<span id="countInProgress">0</span>)
                        </h3>
                    </div>
                    <div class="p-4 space-y-3 kanban-column" data-column="in_progress">
                        <!-- In Progress column intentionally left empty -->
                    </div>
                </div>

                <!-- Missing Column -->
                <div class="bg-red-50 rounded-lg border border-red-200">
                    <div class="p-4 border-b border-red-200">
                        <h3 class="font-semibold text-red-800 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                            Missing (<span id="countMissing">18</span>)
                        </h3>
                    </div>
                    <div class="p-4 space-y-3 kanban-column" data-column="missing">
                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200" data-feature-id="mentor-email-password-registration">
                            <h4 class="font-medium text-gray-900 mb-1">Mentor Email + Password Registration &amp; Authentication</h4>
                            <p class="text-sm text-gray-600 mb-2">Implement standard email/password sign-up flow for mentors with validation and security best practices.</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>

                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200" data-feature-id="mentor-linkedin-social-signin">
                            <h4 class="font-medium text-gray-900 mb-1">Mentor LinkedIn Social Sign-in with Auto-fill</h4>
                            <p class="text-sm text-gray-600 mb-2">Add LinkedIn OAuth login that auto-populates profile data (name, headline, experience, photo, etc.).</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>

                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200" data-feature-id="forgot-password-reset-flow">
                            <h4 class="font-medium text-gray-900 mb-1">Forgot Password / Reset Password Flow</h4>
                            <p class="text-sm text-gray-600 mb-2">Allow mentors to recover accounts via secure password reset.</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>

                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200" data-feature-id="email-confirmation-account-activation">
                            <h4 class="font-medium text-gray-900 mb-1">Email Confirmation / Account Activation</h4>
                            <p class="text-sm text-gray-600 mb-2">Require email verification before mentor can access onboarding/dashboard.</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>

                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200" data-feature-id="mentor-onboarding-ethical-guidelines">
                            <h4 class="font-medium text-gray-900 mb-1">Mentor Onboarding Wizard ‚Äì Ethical Guidelines</h4>
                            <p class="text-sm text-gray-600 mb-2">First step: Display Nailab Ethical Guidelines, Privacy Policy &amp; mandatory acceptance.</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>

                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200" data-feature-id="mentor-onboarding-multi-step-profile">
                            <h4 class="font-medium text-gray-900 mb-1">Mentor Onboarding Wizard ‚Äì Multi-step Profile Completion</h4>
                            <p class="text-sm text-gray-600 mb-2">Build a progressive, step-by-step wizard for complete mentor profile setup with progress bar.</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>

                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200" data-feature-id="mentor-profile-fields-uploads">
                            <h4 class="font-medium text-gray-900 mb-1">Mentor Profile Fields &amp; Uploads in Onboarding</h4>
                            <p class="text-sm text-gray-600 mb-2">Collect all required mentor data with proper input types &amp; validation.</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>

                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200" data-feature-id="mentor-dashboard-layout-navigation">
                            <h4 class="font-medium text-gray-900 mb-1">Mentor Dashboard ‚Äì Layout &amp; Navigation</h4>
                            <p class="text-sm text-gray-600 mb-2">Build the mentor dashboard skeleton with welcome message and persistent left sidebar navigation.</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>

                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200" data-feature-id="dashboard-widgets-key-metrics">
                            <h4 class="font-medium text-gray-900 mb-1">Dashboard Widgets ‚Äì Key Metrics</h4>
                            <p class="text-sm text-gray-600 mb-2">Create 4 statistic widgets/cards for mentor performance overview.</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>

                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200" data-feature-id="dashboard-recommended-startups">
                            <h4 class="font-medium text-gray-900 mb-1">Dashboard ‚Äì Recommended Startups Widget</h4>
                            <p class="text-sm text-gray-600 mb-2">Show personalized list of suggested startups based on mentor expertise.</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>

                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200" data-feature-id="mentorship-requests-management">
                            <h4 class="font-medium text-gray-900 mb-1">Mentorship Requests Management</h4>
                            <p class="text-sm text-gray-600 mb-2">Display incoming requests list with actions (Accept / Decline / Reschedule).</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>

                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200" data-feature-id="my-schedule-calendar-session-controls">
                            <h4 class="font-medium text-gray-900 mb-1">My Schedule ‚Äì Calendar &amp; Session Controls</h4>
                            <p class="text-sm text-gray-600 mb-2">Build mentor's schedule view with session management features.</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>

                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200" data-feature-id="post-session-feedback-rating">
                            <h4 class="font-medium text-gray-900 mb-1">Post-Session Feedback &amp; Rating System</h4>
                            <p class="text-sm text-gray-600 mb-2">Allow mentees to rate sessions; display aggregate ratings for mentor.</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>

                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200" data-feature-id="my-startups-mentees-directory">
                            <h4 class="font-medium text-gray-900 mb-1">My Startups ‚Äì Mentees Directory</h4>
                            <p class="text-sm text-gray-600 mb-2">List all current &amp; past mentees/startups with quick access.</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>

                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200" data-feature-id="in-platform-messaging-center">
                            <h4 class="font-medium text-gray-900 mb-1">In-Platform Messaging Center</h4>
                            <p class="text-sm text-gray-600 mb-2">Real-time chat interface for mentor‚Äìmentee communication.</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>

                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200" data-feature-id="mentor-profile-edit-page">
                            <h4 class="font-medium text-gray-900 mb-1">Mentor Profile Edit Page</h4>
                            <p class="text-sm text-gray-600 mb-2">Allow mentors to update their public profile after onboarding.</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>

                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200" data-feature-id="settings-notifications-preferences">
                            <h4 class="font-medium text-gray-900 mb-1">Settings ‚Äì Notifications &amp; Preferences</h4>
                            <p class="text-sm text-gray-600 mb-2">Mentor account preferences and notification controls.</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>

                        <div class="feature-card bg-white rounded-lg p-3 shadow-sm border border-gray-200" data-feature-id="support-help-section">
                            <h4 class="font-medium text-gray-900 mb-1">Support / Help Section</h4>
                            <p class="text-sm text-gray-600 mb-2">Simple support page with FAQs and contact option.</p>
                            <span class="status-badge bg-red-100 text-red-800">‚ùå Missing</span>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // Set last updated date
        document.getElementById('lastUpdated').textContent = new Date().toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });

        // Kanban drag/drop + persistence
        document.addEventListener('DOMContentLoaded', function() {
            const STORAGE_KEY = 'nailab_mentors_features_board_v2';
            const columns = Array.from(document.querySelectorAll('.kanban-column[data-column]'));
            const cards = Array.from(document.querySelectorAll('.feature-card'));
            let screenshotPaths = [];

            function ensureScreenshotDatalist() {
                let list = document.getElementById('screenshotOptions');
                if (list) return list;
                list = document.createElement('datalist');
                list.id = 'screenshotOptions';
                document.body.appendChild(list);
                return list;
            }

            function updateScreenshotDatalist() {
                const list = ensureScreenshotDatalist();
                list.innerHTML = '';
                screenshotPaths.forEach(p => {
                    const opt = document.createElement('option');
                    opt.value = p;
                    list.appendChild(opt);
                });
            }

            function normalize(str) {
                return (str || '').toLowerCase().replace(/[^a-z0-9\s-]/g, '').replace(/\s+/g, ' ').trim();
            }

            function chooseFirstExisting(candidates) {
                for (const p of candidates) {
                    if (screenshotPaths.includes(p)) return p;
                }
                return null;
            }

            function suggestScreenshotForTitle(title) {
                const t = normalize(title);
                if (!t) return null;

                // Specific, high-confidence mappings
                if (t.includes('password reset') || t.includes('forgot password')) {
                    return chooseFirstExisting(['screenshots/site/auth/auth_password_new.png']);
                }
                if (t.includes('email confirmation') || t.includes('account activation') || t.includes('confirmation')) {
                    return chooseFirstExisting(['screenshots/site/auth/auth_confirmation_new.png']);
                }
                if (t.includes('sign in') || t.includes('login')) {
                    return chooseFirstExisting(['screenshots/site/auth/auth_sign_in.png']);
                }
                if (t.includes('registration') || t.includes('sign up') || t.includes('signup')) {
                    return chooseFirstExisting(['screenshots/site/auth/auth_sign_up.png']);
                }
                if (t.includes('account settings')) {
                    return chooseFirstExisting(['screenshots/founder/account_settings.png']);
                }
                if (t.includes('progress') && (t.includes('tracking') || t.includes('tracker'))) {
                    return chooseFirstExisting(['screenshots/founder/progress_tracker.png']);
                }
                if (t.includes('support')) {
                    return chooseFirstExisting(['screenshots/founder/support_center.png']);
                }
                if (t.includes('messaging') || t.includes('messages')) {
                    return chooseFirstExisting(['screenshots/founder/messages.png']);
                }
                if (t.includes('dashboard')) {
                    return chooseFirstExisting(['screenshots/founder/dashboard.png']);
                }
                if (t.includes('startup profile') || t.includes('startup details') || t.includes('profile wizard')) {
                    return chooseFirstExisting(['screenshots/founder/Startup_profile.png']);
                }

                // Fallback: best-effort filename match
                const tokens = t.split(' ').filter(Boolean);
                let best = null;
                let bestScore = 0;
                for (const p of screenshotPaths) {
                    const n = normalize(p);
                    let score = 0;
                    for (const tok of tokens) {
                        if (tok.length < 4) continue;
                        if (n.includes(tok)) score += 1;
                    }
                    if (score > bestScore) {
                        bestScore = score;
                        best = p;
                    }
                }
                return bestScore >= 2 ? best : null;
            }

            function formatDateTime(iso) {
                if (!iso) return '‚Äî';
                const d = new Date(iso);
                if (Number.isNaN(d.getTime())) return '‚Äî';
                return d.toLocaleString(undefined, {
                    year: 'numeric',
                    month: 'short',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            function ensureMetaRow(card) {
                let meta = card.querySelector('[data-meta-row]');
                if (meta) return meta;
                meta = document.createElement('div');
                meta.dataset.metaRow = '1';
                meta.className = 'mt-2 flex flex-wrap items-center gap-2 text-xs text-slate-500';
                meta.innerHTML = '<span data-created>Created: ‚Äî</span><span class="text-slate-300">‚Ä¢</span><span data-moved>Moved: ‚Äî</span>';
                card.appendChild(meta);
                return meta;
            }

                        function ensureScreenshotSection(card) {
                                let section = card.querySelector('[data-screenshot-section]');
                                if (section) return section;

                                section = document.createElement('div');
                                section.dataset.screenshotSection = '1';
                                section.className = 'mt-2';
                                section.innerHTML = `
                                        <div class="text-xs font-semibold text-slate-700">Screenshot</div>
                                        <a data-ss-link class="text-sm text-blue-600 underline" target="_blank" rel="noopener noreferrer" href="#">Not linked</a>
                                        <img data-ss-img class="mt-2 w-full max-h-40 object-cover rounded-lg border border-slate-200 cursor-pointer" alt="Screenshot preview" hidden />
                                        <div data-ss-picker class="mt-2 flex gap-2 items-center" hidden>
                                            <input data-ss-input class="flex-1 rounded-lg border border-slate-300 bg-white px-2 py-1 text-sm" list="screenshotOptions" placeholder="Choose screenshot path (e.g. screenshots/site/auth/auth_password_new.png)" />
                                            <button type="button" data-ss-set class="rounded-lg border border-slate-300 bg-white px-3 py-1 text-sm hover:bg-slate-50">Set</button>
                                        </div>
                                `;

                // Place it before details toggle if present (keeps it near status)
                const toggle = card.querySelector('[data-details-toggle]');
                if (toggle) {
                    card.insertBefore(section, toggle);
                } else {
                    const meta = card.querySelector('[data-meta-row]');
                    if (meta) card.insertBefore(section, meta);
                    else card.appendChild(section);
                }

                return section;
            }

            function renderCardScreenshot(card) {
                const section = ensureScreenshotSection(card);
                const link = section.querySelector('[data-ss-link]');
                const img = section.querySelector('[data-ss-img]');
                const picker = section.querySelector('[data-ss-picker]');
                const input = section.querySelector('[data-ss-input]');

                const path = card.dataset.screenshotPath || '';
                if (input) input.value = path;

                if (path) {
                    link.textContent = 'Open screenshot';
                    link.href = path;
                    img.src = path;
                    img.hidden = false;
                    img.onclick = () => window.open(path, '_blank', 'noopener');
                } else {
                    link.textContent = 'Not linked';
                    link.href = '#';
                    img.hidden = true;
                    img.src = '';
                }

                // picker visible only while editing
                if (picker) picker.hidden = !card.classList.contains('editing');
            }

            function applyChecklistItem(li, item) {
                const checkbox = li.querySelector('input[type="checkbox"]');
                const label = li.querySelector('[data-check-label]');
                const text = (item && item.text ? String(item.text) : '').trim();
                const done = !!(item && item.done);

                if (label) label.textContent = text;
                if (checkbox) checkbox.checked = done;

                if (label) {
                    label.classList.toggle('line-through', done);
                    label.classList.toggle('text-slate-400', done);
                    label.classList.toggle('text-slate-600', !done);
                }
            }

            function ensureDetailsSection(card) {
                let title = card.querySelector('[data-details-title]');
                let list = card.querySelector('[data-details-list]');
                let wrap = card.querySelector('[data-details-wrap]');
                let toggle = card.querySelector('[data-details-toggle]');
                if (title && list && wrap && toggle) return { title, list, wrap, toggle };

                // Wrap holds title + list so we can hide/show together
                wrap = document.createElement('div');
                wrap.dataset.detailsWrap = '1';
                wrap.className = 'mt-1';

                title = document.createElement('div');
                title.dataset.detailsTitle = '1';
                title.className = 'mt-2 text-xs font-semibold text-slate-700';
                title.textContent = 'Additional details';

                list = document.createElement('ul');
                list.dataset.detailsList = '1';
                list.className = 'mt-1 space-y-1';

                toggle = document.createElement('button');
                toggle.type = 'button';
                toggle.dataset.detailsToggle = '1';
                toggle.className = 'mt-2 text-xs font-semibold text-slate-700 underline hover:text-slate-900';
                toggle.textContent = 'Hide details';

                // Create a stable id for aria-controls
                const controlsId = `details-${card.dataset.featureId || Math.random().toString(36).slice(2)}`;
                wrap.id = controlsId;
                toggle.setAttribute('aria-controls', controlsId);
                toggle.setAttribute('aria-expanded', 'true');

                wrap.appendChild(title);
                wrap.appendChild(list);

                // Insert details before meta row if meta exists; otherwise append.
                const meta = card.querySelector('[data-meta-row]');
                if (meta) {
                    card.insertBefore(wrap, meta);
                    card.insertBefore(toggle, wrap);
                } else {
                    card.appendChild(toggle);
                    card.appendChild(wrap);
                }

                return { title, list, wrap, toggle };
            }

            function getDetails(card) {
                const list = card.querySelector('[data-details-list]');
                if (!list) return [];
                return Array.from(list.querySelectorAll('li')).map(li => {
                    const cb = li.querySelector('input[type="checkbox"]');
                    const label = li.querySelector('[data-check-label]');
                    return {
                        text: (label?.textContent || '').trim(),
                        done: !!cb?.checked
                    };
                }).filter(it => it.text);
            }

            function setDetails(card, details) {
                const { list } = ensureDetailsSection(card);
                list.innerHTML = '';

                const values = Array.isArray(details) ? details : [];
                const normalized = values
                    .map(v => {
                        if (!v) return null;
                        if (typeof v === 'string') return { text: v, done: false };
                        if (typeof v === 'object') return { text: String(v.text || '').trim(), done: !!v.done };
                        return null;
                    })
                    .filter(v => v && v.text);

                normalized.forEach((item) => {
                    const li = document.createElement('li');
                    li.className = 'flex items-start gap-2';
                    li.innerHTML =
                        '<input type="checkbox" class="mt-1 h-4 w-4 rounded border-slate-300 text-emerald-600 focus:ring-emerald-200" />' +
                        '<span data-check-label class="text-sm text-slate-600"></span>';

                    const cb = li.querySelector('input[type="checkbox"]');
                    if (cb) {
                        cb.addEventListener('change', () => {
                            applyChecklistItem(li, { text: item.text, done: cb.checked });
                            saveBoardState();
                        });
                    }

                    applyChecklistItem(li, item);
                    list.appendChild(li);
                });
            }

            function applyDetailsVisibility(card, open) {
                const { wrap, toggle } = ensureDetailsSection(card);
                const isOpen = open !== false;
                card.dataset.detailsOpen = isOpen ? 'true' : 'false';
                wrap.hidden = !isOpen;
                toggle.textContent = isOpen ? 'Hide details' : 'Show details';
                toggle.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
            }

            function renderCardTimestamps(card) {
                const meta = ensureMetaRow(card);
                const createdEl = meta.querySelector('[data-created]');
                const movedEl = meta.querySelector('[data-moved]');
                if (createdEl) createdEl.textContent = `Created: ${formatDateTime(card.dataset.createdAt)}`;
                if (movedEl) movedEl.textContent = `Moved: ${formatDateTime(card.dataset.movedAt)}`;
            }

            function safeText(str) {
                return (str || '').trim().toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9\-]/g, '');
            }

            function ensureCardIds() {
                const seen = new Set();
                cards.forEach((card, idx) => {
                    if (card.dataset.featureId) return;
                    const title = card.querySelector('h4')?.textContent || `feature-${idx}`;
                    let base = safeText(title) || `feature-${idx}`;
                    let candidate = base;
                    let n = 2;
                    while (seen.has(candidate)) {
                        candidate = `${base}-${n}`;
                        n += 1;
                    }
                    seen.add(candidate);
                    card.dataset.featureId = candidate;
                });
            }

            function setBadgeForColumn(card, columnKey) {
                const badge = card.querySelector('.status-badge');
                if (!badge) return;
                badge.classList.remove(
                    'bg-green-100', 'text-green-800',
                    'bg-yellow-100', 'text-yellow-800',
                    'bg-red-100', 'text-red-800'
                );

                if (columnKey === 'complete') {
                    badge.textContent = '‚úÖ Complete';
                    badge.classList.add('bg-green-100', 'text-green-800');
                } else if (columnKey === 'in_progress') {
                    badge.textContent = 'üü° Partial';
                    badge.classList.add('bg-yellow-100', 'text-yellow-800');
                } else {
                    badge.textContent = '‚ùå Missing';
                    badge.classList.add('bg-red-100', 'text-red-800');
                }
            }

            function updateCounts() {
                const completeCount = document.querySelectorAll('.kanban-column[data-column="complete"] .feature-card').length;
                const inProgressCount = document.querySelectorAll('.kanban-column[data-column="in_progress"] .feature-card').length;
                const missingCount = document.querySelectorAll('.kanban-column[data-column="missing"] .feature-card').length;
                const total = completeCount + inProgressCount + missingCount;

                const pct = total === 0 ? 0 : Math.round((completeCount / total) * 100);

                const elCountComplete = document.getElementById('countComplete');
                const elCountInProgress = document.getElementById('countInProgress');
                const elCountMissing = document.getElementById('countMissing');
                const elStatCompletePercent = document.getElementById('statCompletePercent');
                const elStatInProgress = document.getElementById('statInProgress');
                const elStatMissing = document.getElementById('statMissing');
                const elStatTotal = document.getElementById('statTotal');

                if (elCountComplete) elCountComplete.textContent = String(completeCount);
                if (elCountInProgress) elCountInProgress.textContent = String(inProgressCount);
                if (elCountMissing) elCountMissing.textContent = String(missingCount);

                if (elStatCompletePercent) elStatCompletePercent.textContent = `${pct}%`;
                if (elStatInProgress) elStatInProgress.textContent = String(inProgressCount);
                if (elStatMissing) elStatMissing.textContent = String(missingCount);
                if (elStatTotal) elStatTotal.textContent = String(total);
            }

            function saveBoardState() {
                const state = {};
                columns.forEach(col => {
                    const colKey = col.dataset.column;
                    Array.from(col.querySelectorAll('.feature-card')).forEach(card => {
                        const title = card.querySelector('h4')?.textContent?.trim() || '';
                        const desc = card.querySelector('p')?.textContent?.trim() || '';
                        const details = getDetails(card);
                        state[card.dataset.featureId] = {
                            column: colKey,
                            title,
                            desc,
                            details,
                            screenshotPath: card.dataset.screenshotPath || null,
                            detailsOpen: card.dataset.detailsOpen === 'false' ? false : true,
                            createdAt: card.dataset.createdAt || null,
                            movedAt: card.dataset.movedAt || null
                        };
                    });
                });
                try {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
                } catch (_) {
                    // ignore storage errors (private mode, quota, etc.)
                }
            }

            function restoreBoardState() {
                let state = null;
                try {
                    state = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');
                } catch (_) {
                    state = null;
                }
                if (!state || typeof state !== 'object') return;

                const cardById = new Map(cards.map(c => [c.dataset.featureId, c]));
                const columnByKey = new Map(columns.map(c => [c.dataset.column, c]));

                Object.entries(state).forEach(([id, value]) => {
                    const card = cardById.get(id);
                    if (!card) return;

                    // Backward compatibility: older format stored {id: "column"}
                    const colKey = typeof value === 'string' ? value : value?.column;
                    const col = columnByKey.get(colKey);
                    if (col) {
                        col.appendChild(card);
                        setBadgeForColumn(card, colKey);
                    }

                    if (value && typeof value === 'object') {
                        const titleEl = card.querySelector('h4');
                        const descEl = card.querySelector('p');
                        if (titleEl && typeof value.title === 'string') titleEl.textContent = value.title;
                        if (descEl && typeof value.desc === 'string') descEl.textContent = value.desc;

                        if (Array.isArray(value.details)) setDetails(card, value.details);
                        if (typeof value.detailsOpen === 'boolean') applyDetailsVisibility(card, value.detailsOpen);

                        if (typeof value.screenshotPath === 'string' && value.screenshotPath) {
                            card.dataset.screenshotPath = value.screenshotPath;
                        }

                        if (typeof value.createdAt === 'string' && value.createdAt) card.dataset.createdAt = value.createdAt;
                        if (typeof value.movedAt === 'string' && value.movedAt) card.dataset.movedAt = value.movedAt;
                    }
                });
            }

            function bootstrapMissingState() {
                // Ensure every card has a createdAt and meta row even before any drag/edit.
                const nowIso = new Date().toISOString();
                let state = null;
                try {
                    state = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');
                } catch (_) {
                    state = null;
                }
                if (!state || typeof state !== 'object') state = {};

                let changed = false;
                cards.forEach(card => {
                    ensureMetaRow(card);
                    const stored = state?.[card.dataset.featureId];
                    ensureDetailsSection(card);
                    ensureScreenshotSection(card);
                    if (!card.dataset.createdAt) {
                        // Prefer stored value if present; otherwise initialize.
                        if (stored && typeof stored === 'object' && typeof stored.createdAt === 'string' && stored.createdAt) {
                            card.dataset.createdAt = stored.createdAt;
                        } else {
                            card.dataset.createdAt = nowIso;
                            changed = true;
                        }
                    }
                    if (!card.dataset.movedAt) {
                        if (stored && typeof stored === 'object' && typeof stored.movedAt === 'string' && stored.movedAt) {
                            card.dataset.movedAt = stored.movedAt;
                        }
                    }

                    // Default details visibility: open unless stored otherwise
                    if (stored && typeof stored === 'object' && typeof stored.detailsOpen === 'boolean') {
                        applyDetailsVisibility(card, stored.detailsOpen);
                    } else {
                        applyDetailsVisibility(card, true);
                    }

                    renderCardTimestamps(card);
                    renderCardScreenshot(card);
                });

                if (changed) saveBoardState();
            }

            ensureCardIds();

            // Drag + drop
            cards.forEach(card => {
                card.draggable = true;

                // Tailwind-only interactivity (no external CSS)
                card.classList.add('transition', 'duration-200', 'transform', 'hover:-translate-y-0.5', 'hover:shadow-xl', 'cursor-grab', 'select-none');

                // Make title/desc editable on demand
                const titleEl = card.querySelector('h4');
                const descEl = card.querySelector('p');
                if (titleEl) titleEl.classList.add('editable');
                if (descEl) descEl.classList.add('editable');
                const detailsSection = ensureDetailsSection(card);
                const detailsList = detailsSection.list;
                const detailItems = Array.from(detailsList.querySelectorAll('li')).slice(0, 5);

                const screenshotSection = ensureScreenshotSection(card);
                const shotInput = screenshotSection.querySelector('[data-ss-input]');
                const shotSet = screenshotSection.querySelector('[data-ss-set]');

                if (shotSet && shotInput) {
                    shotSet.addEventListener('click', () => {
                        const val = (shotInput.value || '').trim();
                        card.dataset.screenshotPath = val;
                        renderCardScreenshot(card);
                        saveBoardState();
                    });
                }

                // Toggle details
                detailsSection.toggle.addEventListener('click', () => {
                    const open = card.dataset.detailsOpen === 'false';
                    applyDetailsVisibility(card, open);
                    saveBoardState();
                });

                function enableEditing() {
                    card.classList.add('editing');
                    card.classList.add('ring-2', 'ring-blue-300', 'ring-offset-2');
                    card.classList.remove('cursor-grab');
                    card.draggable = false;
                    // Always expand while editing so bullets are accessible
                    applyDetailsVisibility(card, true);
                    if (titleEl) {
                        titleEl.contentEditable = 'true';
                        titleEl.setAttribute('role', 'textbox');
                    }
                    if (descEl) {
                        descEl.contentEditable = 'true';
                        descEl.setAttribute('role', 'textbox');
                    }
                    detailItems.forEach(li => {
                        li.contentEditable = 'true';
                        li.setAttribute('role', 'textbox');
                    });

                    // Show screenshot picker while editing
                    renderCardScreenshot(card);
                    // focus title first
                    if (titleEl) {
                        const range = document.createRange();
                        range.selectNodeContents(titleEl);
                        const sel = window.getSelection();
                        sel.removeAllRanges();
                        sel.addRange(range);
                        titleEl.focus();
                    }
                }

                function disableEditing(save) {
                    card.classList.remove('editing');
                    card.classList.remove('ring-2', 'ring-blue-300', 'ring-offset-2');
                    card.classList.add('cursor-grab');
                    if (titleEl) titleEl.contentEditable = 'false';
                    if (descEl) descEl.contentEditable = 'false';
                    detailItems.forEach(li => (li.contentEditable = 'false'));
                    card.draggable = true;
                    if (save) {
                        saveBoardState();
                    }

                    // Hide screenshot picker
                    renderCardScreenshot(card);
                }

                // Double-click anywhere on the card to edit
                card.addEventListener('dblclick', (e) => {
                    // Avoid triggering edit while dragging
                    if (card.classList.contains('dragging')) return;
                    enableEditing();
                    e.preventDefault();
                });

                // Save on blur (when leaving the card)
                card.addEventListener('focusout', () => {
                    if (!card.classList.contains('editing')) return;
                    // give focus a tick to move between title/desc without exiting edit mode
                    window.setTimeout(() => {
                        const active = document.activeElement;
                        if (card.contains(active)) return;
                        disableEditing(true);
                        renderCardTimestamps(card);
                    }, 0);
                });

                // ESC cancels editing (reverts by reloading from storage snapshot)
                card.addEventListener('keydown', (e) => {
                    if (!card.classList.contains('editing')) return;
                    if (e.key === 'Escape') {
                        e.preventDefault();
                        // restore from saved state
                        restoreBoardState();
                        updateCounts();
                        disableEditing(false);
                    }
                    // prevent Enter from creating new lines in the title
                    if (e.key === 'Enter' && document.activeElement === titleEl) {
                        e.preventDefault();
                        if (descEl) descEl.focus();
                    }
                });

                card.addEventListener('dragstart', (e) => {
                    if (card.classList.contains('editing')) {
                        e.preventDefault();
                        return;
                    }
                    card.classList.add('dragging');
                    card.classList.add('opacity-50', 'cursor-grabbing');
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/plain', card.dataset.featureId);
                });

                card.addEventListener('dragend', () => {
                    card.classList.remove('dragging');
                    card.classList.remove('opacity-50', 'cursor-grabbing');
                    columns.forEach(c => {
                        c.classList.remove('drop-target', 'outline', 'outline-2', 'outline-dashed', 'outline-slate-400', 'outline-offset-4');
                    });
                });
            });

            columns.forEach(col => {
                col.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    col.classList.add('drop-target');
                    col.classList.add('outline', 'outline-2', 'outline-dashed', 'outline-slate-400', 'outline-offset-4');
                });

                col.addEventListener('dragleave', () => {
                    col.classList.remove('drop-target');
                    col.classList.remove('outline', 'outline-2', 'outline-dashed', 'outline-slate-400', 'outline-offset-4');
                });

                col.addEventListener('drop', (e) => {
                    e.preventDefault();
                    col.classList.remove('drop-target');
                    col.classList.remove('outline', 'outline-2', 'outline-dashed', 'outline-slate-400', 'outline-offset-4');
                    const id = e.dataTransfer.getData('text/plain');
                    const dragged = document.querySelector(`.feature-card[data-feature-id="${CSS.escape(id)}"]`);
                    if (!dragged) return;

                    col.appendChild(dragged);
                    setBadgeForColumn(dragged, col.dataset.column);
                    dragged.dataset.movedAt = new Date().toISOString();
                    renderCardTimestamps(dragged);
                    updateCounts();
                    saveBoardState();
                });
            });

            (function seedMentorsChecklistIfMissing() {
                let existingState = null;
                try {
                    const raw = localStorage.getItem(STORAGE_KEY);
                    if (raw) existingState = JSON.parse(raw);
                } catch (_) {
                    existingState = null;
                }
                if (!existingState || typeof existingState !== 'object') existingState = {};

                const seed = {
                    'mentor-email-password-registration': [
                        { text: 'Create registration form (email, password, confirm password)', done: false },
                        { text: 'Implement strong password rules (min length, complexity)', done: false },
                        { text: 'Hash passwords (bcrypt/Argon2)', done: false },
                        { text: 'Basic email uniqueness check', done: false },
                        { text: 'Rate limiting on registration attempts', done: false },
                        { text: 'Unit tests for auth logic', done: false }
                    ],
                    'mentor-linkedin-social-signin': [
                        { text: 'Set up LinkedIn OAuth app & credentials', done: false },
                        { text: 'Implement "Sign in with LinkedIn" button', done: false },
                        { text: 'Handle OAuth callback & token exchange', done: false },
                        { text: 'Map LinkedIn fields to user profile', done: false },
                        { text: 'Option to skip/connect existing account', done: false },
                        { text: 'Fallback to email/password if social fails', done: false }
                    ],
                    'forgot-password-reset-flow': [
                        { text: 'Add "Forgot password" link on login page', done: false },
                        { text: 'Send reset token via email (time-limited, single-use)', done: false },
                        { text: 'Create reset password form (new password + confirm)', done: false },
                        { text: 'Validate token & update password', done: false },
                        { text: 'Success/failure feedback', done: false },
                        { text: 'Email templates for reset request & confirmation', done: false }
                    ],
                    'email-confirmation-account-activation': [
                        { text: 'Generate verification token on sign-up', done: false },
                        { text: 'Send welcome/verification email', done: false },
                        { text: 'Create verification endpoint (link click)', done: false },
                        { text: 'Block login/onboarding until verified', done: false },
                        { text: 'Resend verification email option', done: false },
                        { text: 'Handle expired tokens', done: false }
                    ],
                    'mentor-onboarding-ethical-guidelines': [
                        { text: 'Create full-width page/section with formatted policy text', done: false },
                        { text: 'Add checkbox: I have read and agree', done: false },
                        { text: 'Disable Next until checked', done: false },
                        { text: 'Store acceptance timestamp in DB', done: false },
                        { text: 'Link to full policy documents', done: false }
                    ],
                    'mentor-onboarding-multi-step-profile': [
                        { text: 'Implement wizard layout (steps sidebar + main content)', done: false },
                        { text: 'Add visible progress indicator (percentage/bar)', done: false },
                        { text: 'Steps: Basics, Expertise, Preferences, Availability, Pricing, Review/Submit', done: false },
                        { text: 'Save draft on each step', done: false },
                        { text: 'Save & Exit button on every step', done: false }
                    ],
                    'mentor-profile-fields-uploads': [
                        { text: 'Profile picture upload (crop, resize, storage)', done: false },
                        { text: 'Expertise: multi-select sectors + years', done: false },
                        { text: 'Mentorship preferences (remote/in-person, frequency)', done: false },
                        { text: 'Availability: weekly hours or calendar slots', done: false },
                        { text: 'Session rate (fixed/pro bono toggle)', done: false },
                        { text: 'Real-time validation + error messages', done: false }
                    ],
                    'mentor-dashboard-layout-navigation': [
                        { text: 'Create dashboard layout (sidebar + main content area)', done: false },
                        { text: 'Implement responsive left nav with items', done: false },
                        { text: 'Highlight active route', done: false },
                        { text: 'Mobile: collapsible/hamburger menu', done: false }
                    ],
                    'dashboard-widgets-key-metrics': [
                        { text: 'Total Sessions (lifetime count)', done: false },
                        { text: 'Active Mentees (current count + growth)', done: false },
                        { text: 'Average Session Rating', done: false },
                        { text: 'Hours Mentored (total tracked hours)', done: false }
                    ],
                    'dashboard-recommended-startups': [
                        { text: 'Build Recommended for You section', done: false },
                        { text: 'Query startups matching mentor sectors & challenges', done: false },
                        { text: 'Display 3‚Äì6 cards with match reason', done: false }
                    ],
                    'mentorship-requests-management': [
                        { text: 'List view of pending requests', done: false },
                        { text: 'Status badges (Pending, Accepted, Declined)', done: false },
                        { text: 'Accept ‚Üí confirmation modal + notify founder', done: false },
                        { text: 'Decline ‚Üí modal with optional reason', done: false },
                        { text: 'Reschedule ‚Üí calendar picker + send updated invite', done: false }
                    ],
                    'my-schedule-calendar-session-controls': [
                        { text: 'Calendar/month view + list view toggle', done: false },
                        { text: 'Show upcoming sessions with founder, time, topic', done: false },
                        { text: 'Buttons: View Startup, Join Meeting, Add to Calendar', done: false },
                        { text: 'Set monthly recurring availability', done: false }
                    ],
                    'post-session-feedback-rating': [
                        { text: 'Auto-send feedback form link after session', done: false },
                        { text: 'Store ratings & calculate average', done: false },
                        { text: 'Display mentor overall rating', done: false },
                        { text: 'Optional: view individual session feedback', done: false }
                    ],
                    'my-startups-mentees-directory': [
                        { text: 'Table/card list: startup name, founder, status', done: false },
                        { text: 'Quick links: View Profile, Message Founder, View History', done: false }
                    ],
                    'in-platform-messaging-center': [
                        { text: 'Build messaging inbox/list (conversations)', done: false },
                        { text: 'Chat window with message history', done: false },
                        { text: 'Send/receive text messages', done: false },
                        { text: 'Notification badges & real-time updates', done: false }
                    ],
                    'mentor-profile-edit-page': [
                        { text: 'Form mirroring onboarding fields', done: false },
                        { text: 'Preview mode', done: false },
                        { text: 'Save changes & update matching data', done: false }
                    ],
                    'settings-notifications-preferences': [
                        { text: 'Toggle email/push notifications', done: false },
                        { text: 'Privacy settings (profile visibility)', done: false },
                        { text: 'Account security (change password)', done: false },
                        { text: 'Timezone preference', done: false }
                    ],
                    'support-help-section': [
                        { text: 'Static FAQs', done: false },
                        { text: 'Contact form or email link to support', done: false },
                        { text: 'Optional: link to help center/knowledge base', done: false }
                    ]
                };

                let changed = false;
                cards.forEach((card) => {
                    const id = card.dataset.featureId;
                    const details = seed[id];
                    if (!details) return;

                    const stored = existingState?.[id];
                    const hasDetails = stored && typeof stored === 'object' && Array.isArray(stored.details) && stored.details.length > 0;
                    if (hasDetails) return;

                    setDetails(card, details);
                    changed = true;
                });

                if (changed) saveBoardState();
            })();

            restoreBoardState();
            bootstrapMissingState();
            updateCounts();

            // Load screenshot options (used for linking cards to screenshots)
            fetch('screenshots_index.json')
                .then(r => r.json())
                .then(list => {
                    if (Array.isArray(list)) screenshotPaths = list;
                    updateScreenshotDatalist();

                    // Auto-suggest screenshot for cards that aren't linked yet
                    cards.forEach(card => {
                        if (card.dataset.screenshotPath) return;
                        const title = card.querySelector('h4')?.textContent || '';
                        const suggestion = suggestScreenshotForTitle(title);
                        if (!suggestion) return;
                        card.dataset.screenshotPath = suggestion;
                        renderCardScreenshot(card);
                    });
                    saveBoardState();
                })
                .catch(() => {
                    // ignore; screenshot linking still works if manually typed
                });

        });
    </script>
</body>
</html>